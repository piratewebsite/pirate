---
import { getEntry } from 'astro:content';

interface Props {
  showHeader?: boolean;
  defaultPlatform?: 'ios' | 'android';
}

const { showHeader = true, defaultPlatform = 'ios' } = Astro.props;

// Get site logo
let logoUrl = null;
try {
  const siteSettings = await getEntry('siteSettings', 'main');
  logoUrl = siteSettings?.data?.logoImage;
} catch (error) {
  console.error('Error loading site settings:', error);
}
---

<div class="install-guide-component">
  {showHeader && (
    <div class="install-header">
      <div class="app-icon">
        {logoUrl ? (
          <img src={logoUrl} alt="App Logo" class="logo-img" />
        ) : (
          <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="120" height="120" rx="26" fill="var(--theme-header)"/>
            <path d="M60 30L45 60H55L50 90L75 55H65L70 30H60Z" fill="white"/>
          </svg>
        )}
      </div>
      <h2>Install Our App</h2>
      <p class="subtitle">Get the full experience with our Progressive Web App</p>
    </div>
  )}

  <!-- Platform Tabs -->
  <div class="platform-tabs">
    <button class="tab-btn active" data-platform="ios">
      <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18.71 19.5C17.88 20.74 17 21.95 15.66 21.97C14.32 22 13.89 21.18 12.37 21.18C10.84 21.18 10.37 21.95 9.09997 22C7.78997 22.05 6.79997 20.68 5.95997 19.47C4.24997 17 2.93997 12.45 4.69997 9.39C5.56997 7.87 7.12997 6.91 8.81997 6.88C10.1 6.86 11.32 7.75 12.11 7.75C12.89 7.75 14.37 6.68 15.92 6.84C16.57 6.87 18.39 7.1 19.56 8.82C19.47 8.88 17.39 10.1 17.41 12.63C17.44 15.65 20.06 16.66 20.09 16.67C20.06 16.74 19.67 18.11 18.71 19.5ZM13 3.5C13.73 2.67 14.94 2.04 15.94 2C16.07 3.17 15.6 4.35 14.9 5.19C14.21 6.04 13.07 6.7 11.95 6.61C11.8 5.46 12.36 4.26 13 3.5Z"/>
      </svg>
      iPhone & iPad
    </button>
    <button class="tab-btn" data-platform="android">
      <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M17.6,9.48L16.85,8.82C17.3,8 17.57,7.09 17.57,6.12C17.57,3.34 15.43,1.08 12.77,1C10.1,0.92 7.83,3.01 7.83,5.68C7.83,6.65 8.1,7.56 8.55,8.38L7.8,9.04C6.67,9.96 6,11.34 6,12.8V14C6,14.55 6.45,15 7,15H17C17.55,15 18,14.55 18,14V12.8C18,11.34 17.33,9.96 17.6,9.48M8.5,5.68C8.5,3.5 10.22,1.68 12.4,1.75C14.47,1.82 16.07,3.54 16.07,5.62C16.07,6.39 15.84,7.11 15.43,7.71L14.68,7.05C14.27,6.65 13.64,6.65 13.23,7.05L12,8.28L10.77,7.05C10.36,6.64 9.73,6.64 9.32,7.05L8.57,7.71C8.16,7.11 7.93,6.39 7.93,5.62M9.5,18H6.5V22.5H9.5V18M14.5,18H11.5V22.5H14.5V18M19.5,18H16.5V22.5H19.5V18Z"/>
      </svg>
      Android
    </button>
  </div>

  <!-- iOS Instructions -->
  <div class="platform-content active" data-platform="ios">
    <div class="feature-badge">
      <span class="badge-icon">‚≠ê</span>
      <span>Best Experience on iOS</span>
    </div>
    
    <div class="steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>Open Safari</h3>
          <p>Visit this page using Safari on your iPhone or iPad. Other browsers won't work for installation.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>Tap the Share Button</h3>
          <p>Look for the share icon at the bottom of your screen (or top on iPad).</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>Select "Add to Home Screen"</h3>
          <p>Scroll down and tap "Add to Home Screen" from the menu.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <h3>Confirm Installation</h3>
          <p>Tap "Add" in the top right corner. The app will appear on your home screen!</p>
        </div>
      </div>
    </div>

    <div class="ios-benefits">
      <h3>Why iOS is Better for This App</h3>
      <div class="benefits-grid">
        <div class="benefit">
          <span class="benefit-icon">üîó</span>
          <h4>Contained Browsing</h4>
          <p>External links stay within the app, creating a seamless all-in-one experience.</p>
        </div>
        <div class="benefit">
          <span class="benefit-icon">üì±</span>
          <h4>True App Feel</h4>
          <p>Runs in its own window, separate from Safari, just like a native app.</p>
        </div>
        <div class="benefit">
          <span class="benefit-icon">üéØ</span>
          <h4>Custom Links</h4>
          <p>Add your social media links and access them all from one place without leaving the app.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Android Instructions -->
  <div class="platform-content" data-platform="android">
    <div class="info-badge">
      <span class="badge-icon">‚ÑπÔ∏è</span>
      <span>Limited Features on Android</span>
    </div>

    <div class="steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>Open Chrome</h3>
          <p>Visit this page using Chrome on your Android device.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>Open Menu</h3>
          <p>Tap the three dots menu in the top right corner.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>Install App</h3>
          <p>Look for "Install app" or "Add to Home screen" and tap it.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <h3>Confirm</h3>
          <p>Tap "Install" when prompted. The app will be added to your home screen!</p>
        </div>
      </div>
    </div>

    <div class="android-notice">
      <h3>Android Limitations</h3>
      <p>While you can install our app on Android, some features work differently:</p>
      <ul>
        <li>External links (social media sites) will open in your browser instead of staying in the app</li>
        <li>Custom social links still work, but provide a different experience</li>
        <li>All core features of our site work perfectly</li>
      </ul>
      <p class="notice-footer">For the best all-in-one app experience, we recommend using iOS.</p>
    </div>
  </div>
</div>

<script>
  // Platform tab switching
  function initInstallGuideTabs() {
    const tabs = document.querySelectorAll('.install-guide-component .tab-btn');
    const contents = document.querySelectorAll('.install-guide-component .platform-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const htmlTab = tab as HTMLElement;
        const platform = htmlTab.dataset.platform;
        
        // Update tabs
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update content
        contents.forEach(c => {
          const htmlContent = c as HTMLElement;
          c.classList.remove('active');
          if (htmlContent.dataset.platform === platform) {
            c.classList.add('active');
          }
        });
      });
    });

    // Auto-detect platform and switch tab
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);
    
    if (isAndroid && !isIOS) {
      const androidTab = document.querySelector('.install-guide-component .tab-btn[data-platform="android"]') as HTMLElement;
      androidTab?.click();
    }
  }

  // Initialize on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initInstallGuideTabs);
  } else {
    initInstallGuideTabs();
  }
</script>

<style>
  .install-guide-component {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 0;
  }

  /* Header */
  .install-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .app-icon {
    width: 120px;
    height: 120px;
    margin: 0 auto 1.5rem;
    filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
  }

  .app-icon svg,
  .app-icon .logo-img {
    width: 100%;
    height: 100%;
    border-radius: 26px;
    object-fit: cover;
  }

  .install-header h2 {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: var(--theme-text);
  }

  .subtitle {
    font-size: 1.125rem;
    opacity: 0.8;
    color: var(--theme-text);
  }

  /* Platform Tabs */
  .platform-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
  }

  .tab-btn {
    flex: 1;
    padding: 1rem;
    background: none;
    border: none;
    color: var(--theme-text);
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    opacity: 0.6;
    transition: all 0.2s;
    position: relative;
  }

  .tab-btn:hover {
    opacity: 1;
  }

  .tab-btn.active {
    opacity: 1;
  }

  .tab-btn.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--theme-accent);
  }

  .platform-icon {
    width: 24px;
    height: 24px;
  }

  /* Platform Content */
  .platform-content {
    display: none;
  }

  .platform-content.active {
    display: block;
  }

  /* Badges */
  .feature-badge,
  .info-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 2rem;
  }

  .feature-badge {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .info-badge {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  /* Steps */
  .steps {
    margin-bottom: 3rem;
  }

  .step {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    transition: transform 0.2s;
  }

  .step:hover {
    transform: translateX(4px);
  }

  .step-number {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    background: var(--theme-accent);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.25rem;
  }

  .step-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--theme-text);
  }

  .step-content p {
    opacity: 0.8;
    line-height: 1.6;
    color: var(--theme-text);
  }

  /* iOS Benefits */
  .ios-benefits {
    margin-top: 3rem;
    padding: 2rem;
    background: rgba(34, 197, 94, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(34, 197, 94, 0.1);
  }

  .ios-benefits h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--theme-text);
  }

  .benefits-grid {
    display: grid;
    gap: 1.5rem;
  }

  @media (min-width: 640px) {
    .benefits-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .benefit {
    text-align: center;
  }

  .benefit-icon {
    font-size: 2rem;
    display: block;
    margin-bottom: 0.75rem;
  }

  .benefit h4 {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--theme-text);
  }

  .benefit p {
    font-size: 0.875rem;
    opacity: 0.8;
    color: var(--theme-text);
  }

  /* Android Notice */
  .android-notice {
    margin-top: 3rem;
    padding: 2rem;
    background: rgba(59, 130, 246, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(59, 130, 246, 0.1);
  }

  .android-notice h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--theme-text);
  }

  .android-notice p {
    margin-bottom: 1rem;
    line-height: 1.6;
    color: var(--theme-text);
  }

  .android-notice ul {
    margin: 1.5rem 0;
    padding-left: 1.5rem;
  }

  .android-notice li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
    color: var(--theme-text);
  }

  .notice-footer {
    font-weight: 500;
    color: var(--theme-accent);
  }
</style>
