---
import Base from '../layouts/Base.astro';
import { getEntry } from 'astro:content';

const title = 'Install App';
const description = 'Install our Progressive Web App for the best experience';

// Get site logo
let logoUrl = null;
try {
  const siteSettings = await getEntry('siteSettings', 'main');
  logoUrl = siteSettings?.data?.logoImage;
} catch (error) {
  console.error('Error loading site settings:', error);
}
---

<Base title={title} description={description}>
  <main class="install-page">
    <div class="install-container">
      <!-- Header -->
      <div class="install-header">
        <div class="app-icon">
          {logoUrl ? (
            <img src={logoUrl} alt="App Logo" class="logo-img" />
          ) : (
            <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect width="120" height="120" rx="26" fill="var(--theme-header)"/>
              <path d="M60 30L45 60H55L50 90L75 55H65L70 30H60Z" fill="white"/>
            </svg>
          )}
        </div>
        <h1>Install Our App</h1>
        <p class="subtitle">Get the full experience with our Progressive Web App</p>
      </div>

      <!-- Platform Tabs -->
      <div class="platform-tabs">
        <button class="tab-btn active" data-platform="ios">
          <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18.71 19.5C17.88 20.74 17 21.95 15.66 21.97C14.32 22 13.89 21.18 12.37 21.18C10.84 21.18 10.37 21.95 9.09997 22C7.78997 22.05 6.79997 20.68 5.95997 19.47C4.24997 17 2.93997 12.45 4.69997 9.39C5.56997 7.87 7.12997 6.91 8.81997 6.88C10.1 6.86 11.32 7.75 12.11 7.75C12.89 7.75 14.37 6.68 15.92 6.84C16.57 6.87 18.39 7.1 19.56 8.82C19.47 8.88 17.39 10.1 17.41 12.63C17.44 15.65 20.06 16.66 20.09 16.67C20.06 16.74 19.67 18.11 18.71 19.5ZM13 3.5C13.73 2.67 14.94 2.04 15.94 2C16.07 3.17 15.6 4.35 14.9 5.19C14.21 6.04 13.07 6.7 11.95 6.61C11.8 5.46 12.36 4.26 13 3.5Z"/>
          </svg>
          iPhone & iPad
        </button>
        <button class="tab-btn" data-platform="android">
          <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17.6,9.48L16.85,8.82C17.3,8 17.57,7.09 17.57,6.12C17.57,3.34 15.43,1.08 12.77,1C10.1,0.92 7.83,3.01 7.83,5.68C7.83,6.65 8.1,7.56 8.55,8.38L7.8,9.04C6.67,9.96 6,11.34 6,12.8V14C6,14.55 6.45,15 7,15H17C17.55,15 18,14.55 18,14V12.8C18,11.34 17.33,9.96 17.6,9.48M8.5,5.68C8.5,3.5 10.22,1.68 12.4,1.75C14.47,1.82 16.07,3.54 16.07,5.62C16.07,6.39 15.84,7.11 15.43,7.71L14.68,7.05C14.27,6.65 13.64,6.65 13.23,7.05L12,8.28L10.77,7.05C10.36,6.64 9.73,6.64 9.32,7.05L8.57,7.71C8.16,7.11 7.93,6.39 7.93,5.62M9.5,18H6.5V22.5H9.5V18M14.5,18H11.5V22.5H14.5V18M19.5,18H16.5V22.5H19.5V18Z"/>
          </svg>
          Android
        </button>
      </div>

      <!-- iOS Instructions -->
      <div class="platform-content active" data-platform="ios">
        <div class="feature-badge">
          <span class="badge-icon">‚≠ê</span>
          <span>Best Experience on iOS</span>
        </div>
        
        <div class="steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>Open Safari</h3>
              <p>Visit this page using Safari on your iPhone or iPad. Other browsers won't work for installation.</p>
              <div class="step-image">
                <svg viewBox="0 0 200 120" fill="none">
                  <rect x="20" y="20" width="160" height="80" rx="8" fill="#f3f4f6" stroke="#d1d5db" stroke-width="2"/>
                  <circle cx="100" cy="60" r="20" fill="#0066CC"/>
                  <path d="M100 45L105 55H95L100 45Z" fill="white"/>
                  <path d="M85 60L95 55V65L85 60Z" fill="white"/>
                  <path d="M115 60L105 65V55L115 60Z" fill="white"/>
                  <text x="100" y="95" font-size="10" fill="#666" text-anchor="middle">Safari</text>
                </svg>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>Tap the Share Button</h3>
              <p>Look for the share icon at the bottom of your screen (or top on iPad).</p>
              <div class="step-image">
                <svg viewBox="0 0 200 80" fill="none">
                  <rect x="60" y="10" width="80" height="60" rx="8" fill="#007AFF"/>
                  <path d="M100 25L95 30L97 30L97 45L103 45L103 30L105 30L100 25Z" fill="white"/>
                  <path d="M90 48C90 45.79 91.79 44 94 44L97 44L97 47L94 47C93.45 47 93 47.45 93 48L93 52C93 52.55 93.45 53 94 53L106 53C106.55 53 107 52.55 107 52L107 48C107 47.45 106.55 47 106 47L103 47L103 44L106 44C108.21 44 110 45.79 110 48L110 52C110 54.21 108.21 56 106 56L94 56C91.79 56 90 54.21 90 52L90 48Z" fill="white"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>Select "Add to Home Screen"</h3>
              <p>Scroll down and tap "Add to Home Screen" from the menu.</p>
              <div class="step-image">
                <svg viewBox="0 0 200 100" fill="none">
                  <rect x="30" y="10" width="140" height="80" rx="12" fill="white" stroke="#d1d5db" stroke-width="2"/>
                  <rect x="40" y="40" width="120" height="20" rx="4" fill="#007AFF" opacity="0.1"/>
                  <circle cx="55" cy="50" r="8" fill="#007AFF"/>
                  <path d="M53 50L55 52L58 48" stroke="white" stroke-width="2" fill="none"/>
                  <text x="70" y="53" font-size="10" fill="#007AFF" font-weight="bold">Add to Home Screen</text>
                </svg>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3>Confirm Installation</h3>
              <p>Tap "Add" in the top right corner. The app will appear on your home screen!</p>
              <div class="step-image">
                <svg viewBox="0 0 200 100" fill="none">
                  <rect x="30" y="10" width="140" height="80" rx="12" fill="white" stroke="#d1d5db" stroke-width="2"/>
                  <rect x="130" y="20" width="30" height="15" rx="4" fill="#007AFF"/>
                  <text x="145" y="30" font-size="8" fill="white" text-anchor="middle" font-weight="bold">Add</text>
                  <rect x="50" y="45" width="100" height="8" rx="4" fill="#f3f4f6"/>
                  <rect x="60" y="60" width="80" height="6" rx="3" fill="#f3f4f6"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <div class="ios-benefits">
          <h3>Why iOS is Better for This App</h3>
          <div class="benefits-grid">
            <div class="benefit">
              <span class="benefit-icon">üîó</span>
              <h4>Contained Browsing</h4>
              <p>External links stay within the app, creating a seamless all-in-one experience.</p>
            </div>
            <div class="benefit">
              <span class="benefit-icon">üì±</span>
              <h4>True App Feel</h4>
              <p>Runs in its own window, separate from Safari, just like a native app.</p>
            </div>
            <div class="benefit">
              <span class="benefit-icon">üéØ</span>
              <h4>Custom Links</h4>
              <p>Add your social media links and access them all from one place without leaving the app.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Android Instructions -->
      <div class="platform-content" data-platform="android">
        <div class="info-badge">
          <span class="badge-icon">‚ÑπÔ∏è</span>
          <span>Limited Features on Android</span>
        </div>

        <div class="steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>Open Chrome</h3>
              <p>Visit this page using Chrome on your Android device.</p>
              <div class="step-image">
                <svg viewBox="0 0 200 120" fill="none">
                  <rect x="20" y="20" width="160" height="80" rx="8" fill="#f3f4f6" stroke="#d1d5db" stroke-width="2"/>
                  <circle cx="100" cy="60" r="20" fill="#4285F4"/>
                  <circle cx="100" cy="60" r="15" fill="white"/>
                  <circle cx="100" cy="60" r="8" fill="#4285F4"/>
                  <text x="100" y="95" font-size="10" fill="#666" text-anchor="middle">Chrome</text>
                </svg>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>Open Menu</h3>
              <p>Tap the three dots menu in the top right corner.</p>
              <div class="step-image">
                <svg viewBox="0 0 200 80" fill="none">
                  <rect x="60" y="10" width="80" height="60" rx="8" fill="#5F6368"/>
                  <circle cx="100" cy="25" r="3" fill="white"/>
                  <circle cx="100" cy="40" r="3" fill="white"/>
                  <circle cx="100" cy="55" r="3" fill="white"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>Install App</h3>
              <p>Look for "Install app" or "Add to Home screen" and tap it.</p>
              <div class="step-image">
                <svg viewBox="0 0 200 100" fill="none">
                  <rect x="30" y="10" width="140" height="80" rx="12" fill="white" stroke="#d1d5db" stroke-width="2"/>
                  <rect x="40" y="40" width="120" height="20" rx="4" fill="#4285F4" opacity="0.1"/>
                  <text x="70" y="53" font-size="10" fill="#4285F4" font-weight="bold">Install app</text>
                </svg>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3>Confirm</h3>
              <p>Tap "Install" when prompted. The app will be added to your home screen!</p>
              <div class="step-image">
                <svg viewBox="0 0 200 100" fill="none">
                  <rect x="30" y="10" width="140" height="80" rx="12" fill="white" stroke="#d1d5db" stroke-width="2"/>
                  <rect x="120" y="70" width="40" height="15" rx="4" fill="#4285F4"/>
                  <text x="140" y="80" font-size="8" fill="white" text-anchor="middle" font-weight="bold">Install</text>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <div class="android-notice">
          <h3>Android Limitations</h3>
          <p>While you can install our app on Android, some features work differently:</p>
          <ul>
            <li>External links (social media sites) will open in your browser instead of staying in the app</li>
            <li>Custom social links still work, but provide a different experience</li>
            <li>All core features of our site work perfectly</li>
          </ul>
          <p class="notice-footer">For the best all-in-one app experience, we recommend using iOS.</p>
        </div>
      </div>

      <!-- CTA -->
      <div class="install-cta">
        <a href="/" class="cta-button">Return Home</a>
        <a href="/settings" class="cta-button secondary">Customize Settings</a>
      </div>
    </div>
  </main>
</Base>

<script>
  // Platform tab switching
  const tabs = document.querySelectorAll('.tab-btn');
  const contents = document.querySelectorAll('.platform-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const htmlTab = tab as HTMLElement;
      const platform = htmlTab.dataset.platform;
      
      // Update tabs
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // Update content
      contents.forEach(c => {
        const htmlContent = c as HTMLElement;
        c.classList.remove('active');
        if (htmlContent.dataset.platform === platform) {
          c.classList.add('active');
        }
      });
    });
  });

  // Auto-detect platform and switch tab
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);
  
  if (isAndroid && !isIOS) {
    const androidTab = document.querySelector('.tab-btn[data-platform="android"]') as HTMLElement;
    androidTab?.click();
  }
</script>

<style>
  .install-page {
    min-height: 100vh;
    padding: 2rem 1rem;
  }

  .install-container {
    max-width: 800px;
    margin: 0 auto;
  }

  /* Header */
  .install-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .app-icon {
    width: 120px;
    height: 120px;
    margin: 0 auto 1.5rem;
    filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
    animation: float 3s ease-in-out infinite;
  }

  .logo-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 26px;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .install-header h1 {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
  }

  .subtitle {
    font-size: 1.25rem;
    opacity: 0.8;
  }

  /* Platform Tabs */
  .platform-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    background: rgba(0, 0, 0, 0.05);
    padding: 0.5rem;
    border-radius: 1rem;
  }

  [data-theme="light"] .platform-tabs {
    background: rgba(0, 0, 0, 0.03);
  }

  .tab-btn {
    flex: 1;
    padding: 1rem;
    border: none;
    background: transparent;
    opacity: 0.6;
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-weight: 600;
    font-size: 1rem;
  }

  .tab-btn.active {
    background: #f97316;
    color: white;
    opacity: 1;
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
  }

  .platform-icon {
    width: 24px;
    height: 24px;
  }

  /* Platform Content */
  .platform-content {
    display: none;
  }

  .platform-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Badges */
  .feature-badge, .info-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 2rem;
    font-weight: 600;
    margin-bottom: 2rem;
  }

  .feature-badge {
    background: #10b981;
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .info-badge {
    background: rgba(249, 115, 22, 0.1);
    color: #f97316;
    border: 1px solid rgba(249, 115, 22, 0.3);
  }

  .badge-icon {
    font-size: 1.25rem;
  }

  /* Steps */
  .steps {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .step {
    display: flex;
    gap: 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    padding: 2rem;
    border-radius: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  [data-theme="light"] .step {
    background: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .step:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  [data-theme="light"] .step:hover {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
  }

  .step-number {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #f97316;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 900;
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
  }

  .step-content {
    flex: 1;
  }

  .step-content h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .step-content p {
    opacity: 0.7;
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .step-image {
    width: 100%;
    max-width: 200px;
    margin-top: 1rem;
  }

  .step-image svg {
    width: 100%;
    height: auto;
  }

  /* Benefits */
  .ios-benefits {
    background: rgba(255, 255, 255, 0.05);
    padding: 2rem;
    border-radius: 1.5rem;
    margin-bottom: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  [data-theme="light"] .ios-benefits {
    background: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .ios-benefits h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
  }

  .benefit {
    text-align: center;
  }

  .benefit-icon {
    font-size: 2.5rem;
    display: block;
    margin-bottom: 0.5rem;
  }

  .benefit h4 {
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .benefit p {
    font-size: 0.875rem;
    opacity: 0.7;
    line-height: 1.5;
  }

  /* Android Notice */
  .android-notice {
    background: rgba(255, 255, 255, 0.05);
    padding: 2rem;
    border-radius: 1.5rem;
    margin-bottom: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  [data-theme="light"] .android-notice {
    background: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .android-notice h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }

  .android-notice p {
    opacity: 0.7;
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .android-notice ul {
    list-style: none;
    padding-left: 0;
    margin-bottom: 1rem;
  }

  .android-notice li {
    padding-left: 1.5rem;
    position: relative;
    opacity: 0.7;
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  .android-notice li::before {
    content: "‚Ä¢";
    position: absolute;
    left: 0;
    color: #f97316;
    font-weight: bold;
  }

  .notice-footer {
    font-weight: 600;
    color: #f97316;
  }

  /* CTA */
  .install-cta {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  .cta-button {
    padding: 1rem 2rem;
    border-radius: 0.75rem;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .cta-button:not(.secondary) {
    background: #f97316;
    color: white;
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
  }

  .cta-button:not(.secondary):hover {
    background: #ea580c;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
  }

  .cta-button.secondary {
    background: rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  [data-theme="light"] .cta-button.secondary {
    background: rgba(0, 0, 0, 0.03);
  }

  .cta-button.secondary:hover {
    background: rgba(0, 0, 0, 0.08);
  }

  /* Responsive */
  @media (max-width: 640px) {
    .install-header h1 {
      font-size: 2rem;
    }

    .subtitle {
      font-size: 1rem;
    }

    .step {
      flex-direction: column;
    }

    .platform-tabs {
      flex-direction: column;
    }

    .benefits-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
